var stbStrings=stbOptions.text,stbUploader=stbOptions.uploader,stb=stb||{};(function(n){n(document).ready(function(){var f=n("#save-dialog"),e=n("#save-theme"),y=e.attr("href"),o=n("#stb-name"),s=n("#stb-slug"),h=n("#stb-desc"),c=n("#stb-cover-image"),l=n("#stb-author"),a=n("#stb-author-url"),t="",i,v=stbOptions.media;stb.media=i={buttonId:"#load-cover",imgId:"#stb-cover-image",init:function(){n(this.buttonId).on("click",this.openMediaDialog)},openMediaDialog:function(n){if(n.preventDefault(),this._frame){this._frame.open();return}this._frame=i.frame=wp.media({title:v.title,button:{text:v.button},multiple:!1,library:{type:"image"}});this._frame.on("ready",function(){});this._frame.state("library").on("select",function(){var n=this.get("selection").single();i.handleMediaAttachment(n)});this._frame.open()},handleMediaAttachment:function(t){var i=t.toJSON();n(this.imgId).val(i.url)}};i.init();f.dialog({resizable:!1,modal:!0,autoOpen:!1,width:500,buttons:[{text:stbStrings.save,click:function(){""!=s.val()&&""!=o.val()&&""!=h.val()?(t+="&save="+s.val(),t+="&name="+o.val(),t+="&desc="+h.val(),t+=""!=c.val()?"&cover="+c.val():"",t+=""!=l.val()?"&author="+l.val():"",t+=""!=a.val()?"&au="+a.val():"",document.location=y+t):n(this).dialog("close")}},{text:stbStrings.cancel,click:function(){n(this).dialog("close")}}]});e.click(function(n){n.preventDefault();f.dialog("open")});var r=n("#upload-console"),u=n("#upload-progress"),p=n("#stb-message"),w=new plupload.Uploader({browse_button:"upload-theme",url:stbUploader.url+"?path="+stbUploader.path,multi_selection:!1,filters:{max_file_size:"500kb",mime_types:[{title:"Zip files",extensions:"zip"}]},init:{PostInit:function(){r.text("");u.text("")},FilesAdded:function(n,t){plupload.each(t,function(n){r.text(n.name)});this.start()},UploadProgress:function(n,t){u.text(t.percent+"%")},UploadComplete:function(){r.text("");u.text("");document.location=stbUploader.redirect+"&uploaded=1"},Error:function(n,t){p.addClass("error below-h2").html("<p>"+t.code+": "+t.message+"<\/p>").show()}}});w.init()})})(jQuery)